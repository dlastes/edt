<<<<<<< HEAD
"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map:undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class)};return _wrapNativeSuper(Class)}function isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function _construct(Parent,args,Class){if(isNativeReflectConstruct()){_construct=Reflect.construct}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_setPrototypeOf(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _isNativeFunction(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function createElement(htmlString){var div=document.createElement("div");div.innerHTML=htmlString.trim();return div.firstChild}function isHidden(element){return element.style.display==="none"}function resetElementHTML(htmlElement){htmlElement.innerHTML=""}var CrudField=function(){function CrudField(index,crudLine,columnDesc){_classCallCheck(this,CrudField);this.edit=false;this.index=index;this.crudLine=crudLine;this.columnDesc=columnDesc;this.element=document.createElement("th");this.element.className="align-middle";this.element.setAttribute("scope","row")}_createClass(CrudField,[{key:"setValue",value:function setValue(val){this.crudLine.data[this.index]=val}},{key:"getValue",value:function getValue(){return this.crudLine.data[this.index]}},{key:"showDisplayView",value:function showDisplayView(){this.edit=false;resetElementHTML(this.element);switch(this.columnDesc.type){case"text":this.element.innerHTML=this.getValue();break;case"int":this.element.innerHTML=this.getValue();break;case"select":this.element.innerHTML=this.getValue();break;case"select-chips":var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.getValue()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var value=_step.value;this.element.innerHTML=this.element.innerHTML.concat('<span style="font-size:0.9rem;" class="badge badge-pill badge-secondary mt-1 mr-1 pb-2 pt-2">'+value+"</span>")}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}break;case"select-autocomplete":this.element.innerHTML=this.getValue();break;default:}this.crudLine.addColumn(this.element)}},{key:"showEditView",value:function showEditView(){var _this=this;this.edit=true;resetElementHTML(this.element);var self=this;switch(this.columnDesc.type){case"text":this.element.innerHTML='<input type="text" class="form-control m-0" placeholder="'+this.columnDesc.name+'" value="'+this.getValue()+'" style="background-image:linear-gradient(0deg,#1e99d6 2px,rgba(0,150,136,0) 0),linear-gradient(0deg,rgba(0,0,0,.26) 1px,transparent 0);width:auto !important;">';break;case"int":this.element.innerHTML='<input type="number" class="form-control m-0" placeholder="'+this.columnDesc.name+'" value="'+this.getValue()+'" style="background-image:linear-gradient(0deg,#1e99d6 2px,rgba(0,150,136,0) 0),linear-gradient(0deg,rgba(0,0,0,.26) 1px,transparent 0);width:auto !importan;">';break;case"select":var selectHTML='<select class="custom-select">';var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.columnDesc.options.choices[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var choice=_step2.value;selectHTML=selectHTML.concat('<option value="'+choice+'" '+(choice===this.getValue()?"selected":"")+">"+choice+"</option>")}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]()}}finally{if(_didIteratorError2){throw _iteratorError2}}}selectHTML=selectHTML.concat("</select>");this.element.innerHTML=selectHTML;break;case"select-chips":var options=this.columnDesc.options.all.filter(function(x){return!_this.getValue().includes(x)});var selectChips=document.createElement("select");selectChips.setAttribute("style","width:auto !important");selectChips.setAttribute("class","custom-select mr-2");selectChips.appendChild(createElement("<option>Sélectionner...</option>"));var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=options[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _choice=_step3.value;selectChips.appendChild(createElement('<option value="'+_choice+'">'+_choice+"</option>"))}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]()}}finally{if(_didIteratorError3){throw _iteratorError3}}}selectChips.onchange=function(){var chips=self.createSelectChips(this.value);this.parentNode.appendChild(chips);this.options[this.selectedIndex].remove();this.selectedIndex=0};this.element.appendChild(selectChips);var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.getValue()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var value=_step4.value;this.element.appendChild(this.createSelectChips(value))}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]!=null){_iterator4["return"]()}}finally{if(_didIteratorError4){throw _iteratorError4}}}break;case"select-autocomplete":this.element.innerHTML=this.getValue();break;default:}this.crudLine.addColumn(this.element)}},{key:"validateEdit",value:function validateEdit(){if(this.edit){switch(this.columnDesc.type){case"text":this.setValue(this.element.getElementsByTagName("input")[0].value);break;case"int":var value=parseInt(this.element.getElementsByTagName("input")[0].value);if(!isNaN(value))this.setValue(value);break;case"select":this.setValue(this.element.getElementsByTagName("select")[0].value);break;case"select-chips":var valuesArray=[];var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=this.element.getElementsByClassName("crud-chips")[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _value=_step5.value;valuesArray.push(_value.textContent)}}catch(err){_didIteratorError5=true;_iteratorError5=err}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]!=null){_iterator5["return"]()}}finally{if(_didIteratorError5){throw _iteratorError5}}}this.setValue(valuesArray);break;default:}}}},{key:"createSelectChips",value:function createSelectChips(value){var chips=createElement('<span style="font-size:0.9rem;" class="crud-chips badge badge-pill badge-secondary mt-1 mr-1 pb-2 pt-2">'+value+'<span class="crud-remove-chips-btn bg-light rounded-circle pl-1 pr-1 text-secondary ml-1" aria-hidden="true"><i class="fas fa-times" aria-hidden="true"></i></span></span>');var removeChipsFunction=function removeChipsFunction(){var chips=this.parentNode;var newOption=document.createElement("option");newOption.value=chips.textContent;newOption.textContent=newOption.value;chips.parentNode.getElementsByTagName("select")[0].appendChild(newOption);chips.remove()};chips.getElementsByClassName("crud-remove-chips-btn")[0].onclick=removeChipsFunction;return chips}}]);return CrudField}();var CrudLine=function(){function CrudLine(lineArray,crudTable){_classCallCheck(this,CrudLine);this.data=lineArray;this.crudTable=crudTable;this.element=document.createElement("tr");this.fields=[];for(var i=0;i<lineArray.length;i++){this.fields.push(new CrudField(i,this,crudTable.crudJS.column(i)))}this.showDisplayView()}_createClass(CrudLine,[{key:"showDisplayView",value:function showDisplayView(){resetElementHTML(this.element);this.addNumberColumn();var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.fields[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var field=_step6.value;field.showDisplayView()}}catch(err){_didIteratorError6=true;_iteratorError6=err}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]!=null){_iterator6["return"]()}}finally{if(_didIteratorError6){throw _iteratorError6}}}if(this.crudTable.crudJS.isEditable())this.addActionsColumn();this.crudTable.enableButtons()}},{key:"showEditView",value:function showEditView(){resetElementHTML(this.element);this.addNumberColumn();var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=this.fields[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var field=_step7.value;field.showEditView()}}catch(err){_didIteratorError7=true;_iteratorError7=err}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]!=null){_iterator7["return"]()}}finally{if(_didIteratorError7){throw _iteratorError7}}}if(this.crudTable.crudJS.isEditable())this.addEditActionsColumn();this.crudTable.disableButtons()}},{key:"getStatus",value:function getStatus(){return this.data.status}},{key:"setStatus",value:function setStatus(status){this.data.status=status}},{key:"getElement",value:function getElement(){return this.element}},{key:"addColumn",value:function addColumn(element){this.element.appendChild(element)}},{key:"addNumberColumn",value:function addNumberColumn(){var thNumber=document.createElement("th");thNumber.className="crud-line-number align-middle";thNumber.setAttribute("scope","row");this.element.appendChild(thNumber)}},{key:"addActionsColumn",value:function addActionsColumn(){var self=this;var tdActions=document.createElement("td");tdActions.className="text-right";tdActions.innerHTML='\n            <button type="button" style="width:45px;" class="crud-edit-btn btn btn-raised btn-info mb-1 rounded" title="Editer"><i class="fas fa-pencil-alt"></i></button>\n            <button type="button" style="width:45px;" class="crud-delete-btn btn btn-raised btn-danger mb-1 rounded" data-toggle="modal" data-target="#'+this.crudTable.modalDeleteId+'" title="Supprimer"><i class="fas fa-trash"></i></button>\n        ';tdActions.getElementsByClassName("crud-edit-btn")[0].onclick=function(){self.showEditView();self.crudTable.updateLineNumbers()};tdActions.getElementsByClassName("crud-delete-btn")[0].onclick=function(){var btnValidDelete=self.crudTable.modalDelete.getElementsByClassName("crud-modal-valid")[0];btnValidDelete.onclick=function(){self.setStatus("D");self.element.style.display="none";self.crudTable.updateLineNumbers()}};this.element.appendChild(tdActions)}},{key:"addEditActionsColumn",value:function addEditActionsColumn(){var self=this;var tdActions=document.createElement("td");tdActions.className="text-right";tdActions.innerHTML='\n            <button type="button" style="width:45px;" class="crud-valid-btn btn btn-raised btn-success mb-1 rounded" title="Valider"><i class="fas fa-sm fa-check"></i></button>\n            <button type="button" style="width:45px;" class="crud-cancel-btn btn btn-raised btn-danger mb-1 rounded" title="Annuler"><i class="fas fa-times"></i></button>\n        ';tdActions.getElementsByClassName("crud-valid-btn")[0].onclick=function(){var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=self.fields[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var field=_step8.value;field.validateEdit()}}catch(err){_didIteratorError8=true;_iteratorError8=err}finally{try{if(!_iteratorNormalCompletion8&&_iterator8["return"]!=null){_iterator8["return"]()}}finally{if(_didIteratorError8){throw _iteratorError8}}}if(self.getStatus()==="S")self.setStatus("M");self.showDisplayView();self.crudTable.updateLineNumbers()};tdActions.getElementsByClassName("crud-cancel-btn")[0].onclick=function(){self.showDisplayView();self.crudTable.updateLineNumbers()};this.element.appendChild(tdActions)}}]);return CrudLine}();var CrudTable=function(){function CrudTable(crudJS){_classCallCheck(this,CrudTable);this.crudJS=crudJS;this.element=null;this.lines=[];this.modalDeleteId="crud-modal-"+document.getElementsByClassName("crud-modal").length;this.createModal()}_createClass(CrudTable,[{key:"render",value:function render(){this.element=createElement('<div class="table-responsive"></div>');this.element.innerHTML='\n        <table class="table table-hover">\n          <thead class="thead-light">\n          </thead>\n          <tbody>\n          </tbody>\n        </table>\n        ';this.renderHead();this.renderLines();this.updateLineNumbers();return this.element}},{key:"renderHead",value:function renderHead(){var thead=this.element.getElementsByTagName("thead")[0];thead.innerHTML='<tr><th scope="col"><strong>#</strong></th></tr>';var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=this.crudJS.data().columns[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var col=_step9.value;var _th=document.createElement("th");_th.setAttribute("scope","col");_th.innerHTML="<strong>"+col.name+"</strong>";thead.children[0].appendChild(_th)}}catch(err){_didIteratorError9=true;_iteratorError9=err}finally{try{if(!_iteratorNormalCompletion9&&_iterator9["return"]!=null){_iterator9["return"]()}}finally{if(_didIteratorError9){throw _iteratorError9}}}if(this.crudJS.isEditable()){var th=document.createElement("th");th.setAttribute("scope","col");th.className="text-right pr-3";th.innerHTML="<strong>Action(s)</strong>";thead.children[0].appendChild(th)}}},{key:"renderLines",value:function renderLines(){var tbody=this.element.getElementsByTagName("tbody")[0];var values=this.crudJS.data().values;for(var i=0;i<values.length;i++){var line=new CrudLine(values[i],this);this.lines.push(line);tbody.appendChild(line.getElement())}}},{key:"updateLineNumbers",value:function updateLineNumbers(){var i=1;var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=this.element.getElementsByClassName("crud-line-number")[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var elem=_step10.value;if(!isHidden(elem.parentNode))elem.textContent=i++}}catch(err){_didIteratorError10=true;_iteratorError10=err}finally{try{if(!_iteratorNormalCompletion10&&_iterator10["return"]!=null){_iterator10["return"]()}}finally{if(_didIteratorError10){throw _iteratorError10}}}}},{key:"disableButtons",value:function disableButtons(){var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=this.element.getElementsByClassName("crud-edit-btn")[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var elem=_step11.value;elem.disabled=true}}catch(err){_didIteratorError11=true;_iteratorError11=err}finally{try{if(!_iteratorNormalCompletion11&&_iterator11["return"]!=null){_iterator11["return"]()}}finally{if(_didIteratorError11){throw _iteratorError11}}}var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=this.element.getElementsByClassName("crud-delete-btn")[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var _elem=_step12.value;_elem.disabled=true}}catch(err){_didIteratorError12=true;_iteratorError12=err}finally{try{if(!_iteratorNormalCompletion12&&_iterator12["return"]!=null){_iterator12["return"]()}}finally{if(_didIteratorError12){throw _iteratorError12}}}}},{key:"enableButtons",value:function enableButtons(){var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=this.element.getElementsByClassName("crud-edit-btn")[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var elem=_step13.value;elem.disabled=false}}catch(err){_didIteratorError13=true;_iteratorError13=err}finally{try{if(!_iteratorNormalCompletion13&&_iterator13["return"]!=null){_iterator13["return"]()}}finally{if(_didIteratorError13){throw _iteratorError13}}}var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=this.element.getElementsByClassName("crud-delete-btn")[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=true){var _elem2=_step14.value;_elem2.disabled=false}}catch(err){_didIteratorError14=true;_iteratorError14=err}finally{try{if(!_iteratorNormalCompletion14&&_iterator14["return"]!=null){_iterator14["return"]()}}finally{if(_didIteratorError14){throw _iteratorError14}}}}},{key:"createModal",value:function createModal(){this.modalDelete=createElement('\n        <div class="modal fade" id="'+this.modalDeleteId+'" tabindex="-1" role="dialog" aria-hidden="true">\n          <div class="modal-dialog" role="document">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title">Attention !</h5>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                  <span aria-hidden="true">&times;</span>\n                </button>\n              </div>\n              <div class="modal-body">\n                Voulez-vous vraiment supprimer cette ligne ?\n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Non</button>\n                <button type="button" class="btn btn-raised btn-info crud-modal-valid" data-dismiss="modal">Oui</button>\n              </div>\n            </div>\n          </div>\n        </div>\n        ');document.body.appendChild(this.modalDelete)}}]);return CrudTable}();var CrudJS=function(_HTMLElement){_inherits(CrudJS,_HTMLElement);function CrudJS(){var _this2;_classCallCheck(this,CrudJS);_this2=_possibleConstructorReturn(this,_getPrototypeOf(CrudJS).call(this));_this2.init();return _this2}_createClass(CrudJS,[{key:"init",value:function init(){this.attr={};this.attr.urls={};this.attr.isLoading=true;var url=this.getAttribute("url");var editable=this.getAttribute("editable");var saveButtonId=this.getAttribute("save-button");var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=this.children[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=true){var child=_step15.value;switch(child.nodeName){case"LOADING":this.attr.loadNode=createElement(child.innerHTML);break;case"ERROR":this.attr.errorNode=createElement(child.innerHTML);break;case"URL-GET":this.attr.urls.get=child.textContent.trim();break;case"URL-MODIFY":this.attr.urls.modify=child.textContent.trim();break;case"URL-DELETE":this.attr.urls["delete"]=child.textContent.trim();break;case"URL-NEW":this.attr.urls["new"]=child.textContent.trim();break;default:}}}catch(err){_didIteratorError15=true;_iteratorError15=err}finally{try{if(!_iteratorNormalCompletion15&&_iterator15["return"]!=null){_iterator15["return"]()}}finally{if(_didIteratorError15){throw _iteratorError15}}}resetElementHTML(this);if(!this.attr.loadNode){this.attr.loadNode=createElement("<p>Chargement...</p>")}if(!this.attr.errorNode){this.attr.errorNode=createElement('\n            <div class="alert alert-warning" role="alert">\n                <strong><span class="crud-error-t">ERROR</span>:</strong>\n                <span class="crud-error-m">Unknown</span>\n            </div>\n            ')}if(!this.attr.urls.get)this.attr.urls.get=url;if(!this.attr.urls.modify)this.attr.urls.modify=url;if(!this.attr.urls["delete"])this.attr.urls["delete"]=url;if(!this.attr.urls["new"])this.attr.urls["new"]=url;this.attr.isEditable=editable===null?false:true;var settingsOk=true;for(var attr_url in this.attr.urls){if(!this.attr.urls[attr_url]&&settingsOk){settingsOk=false;break}}if(!saveButtonId&&this.isEditable()&&settingsOk){settingsOk=false}else{this.attr.saveButton=document.getElementById(saveButtonId);if(this.attr.saveButton===null&&this.isEditable()&&settingsOk){settingsOk=false}}if(settingsOk){this.attr.data=null;this.attr.table=new CrudTable(this);if(this.isEditable()){var self=this;this.attr.saveButton.onclick=function(){self.save()}}this.load()}else{this.displayError("Erreur","simple-crud n'est pas correctement configuré.")}}},{key:"load",value:function load(){var _this3=this;this.attr.isLoading=true;this.displayLoad();fetch(this.urlGet()).then(function(response){return response.json()}).then(function(json){_this3.parseData(json);_this3.displayView();_this3.attr.isLoading=false})["catch"](function(err){_this3.displayError("Error",err);_this3.attr.isLoading=false})}},{key:"parseData",value:function parseData(json){var _iteratorNormalCompletion16=true;var _didIteratorError16=false;var _iteratorError16=undefined;try{for(var _iterator16=json.values[Symbol.iterator](),_step16;!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=true){var line=_step16.value;line.status="S"}}catch(err){_didIteratorError16=true;_iteratorError16=err}finally{try{if(!_iteratorNormalCompletion16&&_iterator16["return"]!=null){_iterator16["return"]()}}finally{if(_didIteratorError16){throw _iteratorError16}}}this.attr.data=json}},{key:"data",value:function data(){return this.attr.data}},{key:"urlGet",value:function urlGet(){return this.attr.urls.get}},{key:"urlModify",value:function urlModify(){return this.attr.urls.modify}},{key:"urlDelete",value:function urlDelete(){return this.attr.urls["delete"]}},{key:"urlNew",value:function urlNew(){return this.attr.urls["new"]}},{key:"isEditable",value:function isEditable(){return this.attr.isEditable}},{key:"isLoading",value:function isLoading(){return this.attr.isLoading}},{key:"setChild",value:function setChild(child){this.appendChild(child)}},{key:"resetView",value:function resetView(){resetElementHTML(this)}},{key:"displayView",value:function displayView(){this.resetView();this.setChild(this.attr.table.render())}},{key:"displayLoad",value:function displayLoad(){this.resetView();this.setChild(this.attr.loadNode)}},{key:"displayError",value:function displayError(errorTitle,errorMsg){this.resetView();var _iteratorNormalCompletion17=true;var _didIteratorError17=false;var _iteratorError17=undefined;try{for(var _iterator17=this.attr.errorNode.getElementsByClassName("crud-error-t")[Symbol.iterator](),_step17;!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=true){var title=_step17.value;title.textContent=errorTitle}}catch(err){_didIteratorError17=true;_iteratorError17=err}finally{try{if(!_iteratorNormalCompletion17&&_iterator17["return"]!=null){_iterator17["return"]()}}finally{if(_didIteratorError17){throw _iteratorError17}}}var _iteratorNormalCompletion18=true;var _didIteratorError18=false;var _iteratorError18=undefined;try{for(var _iterator18=this.attr.errorNode.getElementsByClassName("crud-error-m")[Symbol.iterator](),_step18;!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=true){var msg=_step18.value;msg.textContent=errorMsg}}catch(err){_didIteratorError18=true;_iteratorError18=err}finally{try{if(!_iteratorNormalCompletion18&&_iterator18["return"]!=null){_iterator18["return"]()}}finally{if(_didIteratorError18){throw _iteratorError18}}}this.setChild(this.attr.errorNode)}},{key:"save",value:function save(){if(this.data()){console.log("SAVE",this.data())}else{console.log("NOT READY TO SAVE")}}},{key:"column",value:function column(index){return this.attr.data.columns[index]}},{key:"attributeChangedCallback",value:function attributeChangedCallback(name,oldValue,newValue){if((name==="editable"||newValue!==null)&&!this.isLoading())this.init()}}],[{key:"observedAttributes",get:function get(){return["url","save-button","editable"]}}]);return CrudJS}(_wrapNativeSuper(HTMLElement));customElements.define("crud-js",CrudJS);
=======
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(a,n.prototype),a}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper(e){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function createElement(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}function resetElementHTML(e){e.innerHTML=""}function isHidden(e){return"none"===e.style.display}var CrudField=function(){function r(e,t,n){_classCallCheck(this,r),this.edit=!1,this.index=e,this.crudLine=t,this.columnDesc=n,this.element=document.createElement("th"),this.element.className="align-middle",this.element.setAttribute("scope","row")}return _createClass(r,[{key:"setValue",value:function(e){this.crudLine.getValues()[this.index]=e}},{key:"getValue",value:function(){return this.crudLine.getValues()[this.index]}},{key:"prepareDisplayView",value:function(){this.edit=!1,resetElementHTML(this.element);var e=this.getValue();switch(this.columnDesc.type){case"text":case"int":case"select":this.element.innerHTML=e;break;case"select-chips":var t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var l=a.value;this.element.innerHTML=this.element.innerHTML.concat('<span style="font-size:0.9rem;" class="badge badge-pill badge-secondary mt-1 mr-1 pb-2 pt-2">'+l+"</span>")}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}}},{key:"showDisplayView",value:function(){this.prepareDisplayView(),this.crudLine.addColumn(this.element)}},{key:"prepareEditView",value:function(){this.edit=!0,resetElementHTML(this.element);var t=this,n=this.getValue();switch(this.columnDesc.type){case"text":n=n||"",this.element.innerHTML='<input type="text" class="form-control m-0" placeholder="'+this.columnDesc.name+'" value="'+n+'" style="background-image:linear-gradient(0deg,#1e99d6 2px,rgba(0,150,136,0) 0),linear-gradient(0deg,rgba(0,0,0,.26) 1px,transparent 0);width:auto !important;">';break;case"int":n=n||"",this.element.innerHTML='<input type="number" class="form-control m-0" placeholder="'+this.columnDesc.name+'" value="'+n+'" style="background-image:linear-gradient(0deg,#1e99d6 2px,rgba(0,150,136,0) 0),linear-gradient(0deg,rgba(0,0,0,.26) 1px,transparent 0);width:auto !importan;">';break;case"select":n=n||"";var e='<select class="custom-select">',r=!0,a=!1,i=void 0;try{for(var l,s=this.columnDesc.options.values[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){var o=l.value;e=e.concat('<option value="'+o+'" '+(o===n?"selected":"")+">"+o+"</option>")}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}e=e.concat("</select>"),this.element.innerHTML=e;break;case"select-chips":n=n||[];var u=this.columnDesc.options.values.filter(function(e){return!n.includes(e)}),d=document.createElement("select");d.setAttribute("style","width:auto !important"),d.setAttribute("class","custom-select mr-2"),d.appendChild(createElement("<option>Sélectionner...</option>"));var c=!0,h=!1,f=void 0;try{for(var m,y=u[Symbol.iterator]();!(c=(m=y.next()).done);c=!0){var v=m.value;d.appendChild(createElement('<option value="'+v+'">'+v+"</option>"))}}catch(e){h=!0,f=e}finally{try{c||null==y.return||y.return()}finally{if(h)throw f}}d.onchange=function(){var e=t.createSelectChips(this.value);this.parentNode.appendChild(e),this.options[this.selectedIndex].remove(),this.selectedIndex=0},this.element.appendChild(d);var p=!0,b=!1,g=void 0;try{for(var C,E=n[Symbol.iterator]();!(p=(C=E.next()).done);p=!0){var w=C.value;this.element.appendChild(this.createSelectChips(w))}}catch(e){b=!0,g=e}finally{try{p||null==E.return||E.return()}finally{if(b)throw g}}}}},{key:"showEditView",value:function(){this.prepareEditView(),this.crudLine.addColumn(this.element)}},{key:"validateEdit",value:function(){if(this.edit)switch(this.columnDesc.type){case"text":this.setValue(this.element.getElementsByTagName("input")[0].value);break;case"int":var e=parseInt(this.element.getElementsByTagName("input")[0].value);isNaN(e)||this.setValue(e);break;case"select":this.setValue(this.element.getElementsByTagName("select")[0].value);break;case"select-chips":var t=[],n=!0,r=!1,a=void 0;try{for(var i,l=this.element.getElementsByClassName("crudjs-chips")[Symbol.iterator]();!(n=(i=l.next()).done);n=!0){var s=i.value;t.push(s.textContent)}}catch(e){r=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw a}}this.setValue(t)}}},{key:"createSelectChips",value:function(e){var t=createElement('<span style="font-size:0.9rem;" class="crudjs-chips badge badge-pill badge-secondary mt-1 mr-1 pb-2 pt-2">'+e+'<span class="crudjs-remove-chips-btn bg-light rounded-circle pl-1 pr-1 text-secondary ml-1" aria-hidden="true"><i class="fas fa-times" aria-hidden="true"></i></span></span>');return t.getElementsByClassName("crudjs-remove-chips-btn")[0].onclick=function(){var e=this.parentNode,t=document.createElement("option");t.value=e.textContent,t.textContent=t.value,e.parentNode.getElementsByTagName("select")[0].appendChild(t),e.remove()},t}}]),r}(),CrudEditLine=function(){function r(e,t){_classCallCheck(this,r),this.values=e,this.crudTable=t,this.element=document.createElement("tr"),this.element.className="crudjs-edit-line",this.fields=[];for(var n=0;n<this.values.length;n++)this.fields.push(new CrudField(n,this,this.crudTable.getCrudComponent().getData().columns[n]));this.showDisplayView()}return _createClass(r,[{key:"showDisplayView",value:function(){resetElementHTML(this.element),this.addNumberColumn();var e=!0,t=!1,n=void 0;try{for(var r,a=this.fields[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.showDisplayView()}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}this.crudTable.getCrudComponent().isEditable()&&this.addActionsColumn(),this.crudTable.enableButtons()}},{key:"showEditView",value:function(){if(this.crudTable.getCrudComponent().isEditable()){resetElementHTML(this.element),this.addNumberColumn();var e=!0,t=!1,n=void 0;try{for(var r,a=this.fields[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.showEditView()}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}this.addEditActionsColumn(),this.crudTable.disableButtons()}}},{key:"getStatus",value:function(){return this.values.status}},{key:"setStatus",value:function(e){this.values.status=e}},{key:"getElement",value:function(){return this.element}},{key:"getValues",value:function(){return this.values}},{key:"addColumn",value:function(e){this.element.appendChild(e)}},{key:"addNumberColumn",value:function(){var e=document.createElement("th");e.className="crudjs-line-number align-middle",e.setAttribute("scope","row"),this.element.appendChild(e)}},{key:"addActionsColumn",value:function(){var t=this,e=document.createElement("td");e.className="text-right",e.innerHTML='\n            <button type="button" style="width:45px;" class="crudjs-edit-btn btn btn-raised btn-info mb-1 rounded" title="Editer"><i class="fas fa-pencil-alt"></i></button>\n            <button type="button" style="width:45px;" class="crudjs-delete-btn btn btn-raised btn-danger mb-1 rounded" data-toggle="modal" data-target="#'+this.crudTable.modalDeleteId+'" title="Supprimer"><i class="fas fa-trash"></i></button>\n        ',e.getElementsByClassName("crudjs-edit-btn")[0].onclick=function(){t.showEditView(),t.crudTable.updateLineNumbers()},e.getElementsByClassName("crudjs-delete-btn")[0].onclick=function(){t.crudTable.getModalDelete().getElementsByClassName("crudjs-modal-valid")[0].onclick=function(){if("N"!==t.getStatus())t.setStatus("D"),t.element.style.display="none";else{t.element.remove();var e=t.crudTable.getCrudComponent().getData().values;e.splice(e.indexOf(t.values),1)}t.crudTable.updateLineNumbers()}},this.element.appendChild(e)}},{key:"addEditActionsColumn",value:function(){var i=this,e=document.createElement("td");e.className="text-right",e.innerHTML='\n            <button type="button" style="width:45px;" class="crudjs-valid-btn btn btn-raised btn-success mb-1 rounded" title="Valider"><i class="fas fa-sm fa-check"></i></button>\n            <button type="button" style="width:45px;" class="crudjs-cancel-btn btn btn-raised btn-danger mb-1 rounded" title="Annuler"><i class="fas fa-times"></i></button>\n        ',e.getElementsByClassName("crudjs-valid-btn")[0].onclick=function(){var e=!0,t=!1,n=void 0;try{for(var r,a=i.fields[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.validateEdit()}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}"S"===i.getStatus()&&i.setStatus("M"),i.showDisplayView(),i.crudTable.updateLineNumbers()},e.getElementsByClassName("crudjs-cancel-btn")[0].onclick=function(){i.showDisplayView(),i.crudTable.updateLineNumbers()},this.element.appendChild(e)}}]),r}(),CrudAddLine=function(){function r(e){_classCallCheck(this,r),this.crudTable=e,this.element=document.createElement("tr"),this.element.className="crudjs-add-line";var t=this.crudTable.getCrudComponent().getData().columns;this.initData(t.length),this.fields=[];for(var n=0;n<this.values.length;n++)this.fields.push(new CrudField(n,this,t[n]));this.show()}return _createClass(r,[{key:"initData",value:function(e){this.values=new Array(e),this.values.status="N",this.values.oldValue=_toConsumableArray(this.values)}},{key:"show",value:function(){resetElementHTML(this.element),this.addEmptyColumn();var e=!0,t=!1,n=void 0;try{for(var r,a=this.fields[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.showEditView()}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}this.crudTable.getCrudComponent().isEditable()&&this.addActionsColumn(),this.crudTable.enableButtons()}},{key:"getElement",value:function(){return this.element}},{key:"getValues",value:function(){return this.values}},{key:"addColumn",value:function(e){this.element.appendChild(e)}},{key:"addEmptyColumn",value:function(){var e=document.createElement("th");e.setAttribute("scope","row"),this.element.appendChild(e)}},{key:"addActionsColumn",value:function(){var c=this,e=document.createElement("td");e.className="text-right",e.innerHTML='\n            <button type="button" style="width:45px;" class="crudjs-add-btn btn btn-raised btn-secondary mb-1 rounded" title="Ajouter"><i class="fas fa-plus"></i></button>\n            <button type="button" style="width:45px;" class="crudjs-add-cancel-btn btn btn-raised btn-danger mb-1 rounded" title="Réinitialiser"><i class="fas fa-times"></i></button>\n        ',e.getElementsByClassName("crudjs-add-btn")[0].onclick=function(){var e=!0,t=!1,n=void 0;try{for(var r,a=c.fields[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.validateEdit()}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}var i=c.values;c.crudTable.getCrudComponent().getData().values.push(i),c.crudTable.addCrudLine(new CrudEditLine(i,c.crudTable)),c.initData(c.values.length);var l=!0,s=!1,o=void 0;try{for(var u,d=c.fields[Symbol.iterator]();!(l=(u=d.next()).done);l=!0){u.value.prepareEditView()}}catch(e){s=!0,o=e}finally{try{l||null==d.return||d.return()}finally{if(s)throw o}}c.crudTable.updateLineNumbers()},e.getElementsByClassName("crudjs-add-cancel-btn")[0].onclick=function(){var e=!0,t=!1,n=void 0;try{for(var r,a=c.fields[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.prepareEditView()}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}c.crudTable.updateLineNumbers()},this.element.appendChild(e)}}]),r}(),CrudTable=function(){function t(e){_classCallCheck(this,t),this.crudComponent=e,this.element=createElement('<div class="table-responsive"></div>'),this.element.innerHTML='\n        <table class="table">\n          <thead class="thead-light">\n          </thead>\n          <tbody>\n          </tbody>\n        </table>\n        ',this.thead=this.element.getElementsByTagName("thead")[0],this.tbody=this.element.getElementsByTagName("tbody")[0],this.modalDeleteId="crudjs-modal-"+ ++t.ID,this.modalDelete=this.createModal()}return _createClass(t,[{key:"render",value:function(){this.resetTable(),this.renderHead(),this.renderLines(),this.updateLineNumbers()}},{key:"resetTable",value:function(){resetElementHTML(this.thead),resetElementHTML(this.tbody)}},{key:"renderHead",value:function(){var e=!0,t=!(this.thead.innerHTML='<tr><th scope="col"><strong>#</strong></th></tr>'),n=void 0;try{for(var r,a=this.crudComponent.getData().columns[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value,l=document.createElement("th");l.setAttribute("scope","col"),l.innerHTML="<strong>"+i.name+"</strong>",this.thead.children[0].appendChild(l)}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}if(this.crudComponent.isEditable()){var s=document.createElement("th");s.setAttribute("scope","col"),s.className="text-right pr-3",s.innerHTML="<strong>Action(s)</strong>",this.thead.children[0].appendChild(s)}}},{key:"renderLines",value:function(){this.getCrudComponent().isEditable()&&this.addCrudLine(new CrudAddLine(this));for(var e=this.crudComponent.getData().values,t=0;t<e.length;t++)this.addCrudLine(new CrudEditLine(e[t],this))}},{key:"addCrudLine",value:function(e){this.tbody.appendChild(e.getElement())}},{key:"updateLineNumbers",value:function(){var e=1,t=!0,n=!1,r=void 0;try{for(var a,i=this.element.getElementsByClassName("crudjs-line-number")[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var l=a.value;isHidden(l.parentNode)||(l.textContent=e++)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"disableButtons",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.element.getElementsByClassName("crudjs-edit-btn")[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.disabled=!0}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}var i=!0,l=!1,s=void 0;try{for(var o,u=this.element.getElementsByClassName("crudjs-delete-btn")[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){o.value.disabled=!0}}catch(e){l=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(l)throw s}}var d=!0,c=!1,h=void 0;try{for(var f,m=this.element.getElementsByClassName("crudjs-add-btn")[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){f.value.disabled=!0}}catch(e){c=!0,h=e}finally{try{d||null==m.return||m.return()}finally{if(c)throw h}}var y=!0,v=!1,p=void 0;try{for(var b,g=this.element.getElementsByClassName("crudjs-add-cancel-btn")[Symbol.iterator]();!(y=(b=g.next()).done);y=!0){b.value.disabled=!0}}catch(e){v=!0,p=e}finally{try{y||null==g.return||g.return()}finally{if(v)throw p}}}},{key:"enableButtons",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.element.getElementsByClassName("crudjs-edit-btn")[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.disabled=!1}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}var i=!0,l=!1,s=void 0;try{for(var o,u=this.element.getElementsByClassName("crudjs-delete-btn")[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){o.value.disabled=!1}}catch(e){l=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(l)throw s}}var d=!0,c=!1,h=void 0;try{for(var f,m=this.element.getElementsByClassName("crudjs-add-btn")[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){f.value.disabled=!1}}catch(e){c=!0,h=e}finally{try{d||null==m.return||m.return()}finally{if(c)throw h}}var y=!0,v=!1,p=void 0;try{for(var b,g=this.element.getElementsByClassName("crudjs-add-cancel-btn")[Symbol.iterator]();!(y=(b=g.next()).done);y=!0){b.value.disabled=!1}}catch(e){v=!0,p=e}finally{try{y||null==g.return||g.return()}finally{if(v)throw p}}}},{key:"createModal",value:function(){var e=createElement('\n        <div class="modal fade" id="'+this.modalDeleteId+'" tabindex="-1" role="dialog" aria-hidden="true">\n          <div class="modal-dialog" role="document">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title">Attention !</h5>\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                  <span aria-hidden="true">&times;</span>\n                </button>\n              </div>\n              <div class="modal-body">\n                Voulez-vous vraiment supprimer cette ligne ?\n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary mr-1" data-dismiss="modal">Non</button>\n                <button type="button" class="btn btn-raised btn-info crudjs-modal-valid" data-dismiss="modal">Oui</button>\n              </div>\n            </div>\n          </div>\n        </div>\n        ');return document.body.appendChild(e),e}},{key:"getElement",value:function(){return this.element}},{key:"getModalDelete",value:function(){return this.modalDelete}},{key:"getModalDeleteId",value:function(){return this.modalDeleteId}},{key:"getCrudComponent",value:function(){return this.crudComponent}}]),t}();CrudTable.ID=0;var CrudRequest=function(){function n(e,t){_classCallCheck(this,n),this.url=e,this.addMessageFunc=t}return _createClass(n,[{key:"get",value:function(t,n){fetch(this.url,{method:"GET"}).then(function(e){return e.json()}).then(function(e){e.values.forEach(function(e){e.oldValue=_toConsumableArray(e),e.status="S"}),t(e)}).catch(function(e){n(e)})}},{key:"send",value:function(t){var n=[],r=[],a=[],i=[];this.noError=!0;var l=this;t.forEach(function(e){switch(e.status){case"N":n.push(e);break;case"M":r.push(e.oldValue),a.push(e);break;case"D":i.push(e.oldValue)}});var e={"Content-Type":"application/json"};"undefined"!=typeof CSRF&&null!==CSRF&&(e["X-CSRFToken"]=CSRF),fetch(l.url,{method:"POST",headers:e,body:JSON.stringify({actions:[{request:"NEW",new_values:n},{request:"MODIFIED",old_values:r,new_values:a},{request:"DELETED",old_values:i}]})}).then(function(e){return e.json()}).then(function(e){e.actions.forEach(function(e){"result"in e?l.handle(e,t):(l.noError=!1,l.addMessageFunc("danger","Error","Bad response"))}),l.noError&&l.addMessageFunc("success","OK","Sauvegarde effectuée")}).catch(function(e){console.error(e)})}},{key:"handle",value:function(r,a){var i=this;switch(r.request){case"NEW":r.result.forEach(function(e,t){if("ERROR"===e[0])i.addMessageFunc("warning","Erreur","Ajout de la ligne '"+r.new_values[t].join(", ")+"' impossible: "+e[1]),i.noError=!1;else{var n=a.find(function(e){return e.join("&")===r.new_values[t].join("&")});n.status="S",n.oldValue=r.new_values[t]}});break;case"MODIFIED":r.result.forEach(function(e,t){if("ERROR"===e[0])i.addMessageFunc("warning","Erreur","Modification de la ligne '"+r.new_values[t].join(", ")+"' impossible: "+e[1]),i.noError=!1;else{var n=a.find(function(e){return e.join("&")===r.new_values[t].join("&")});n.status="S",n.oldValue=r.new_values[t]}});break;case"DELETED":r.result.forEach(function(e,t){"ERROR"===e[0]?(i.addMessageFunc("warning","Erreur","Suppression de la ligne '"+r.old_values[t].join(", ")+"' impossible: "+e[1]),i.noError=!1):delete a[a.findIndex(function(e){return e.oldValue.join("&")===r.old_values[t].join("&")})]})}}}]),n}(),CrudComponent=function(){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).init(),e}return _inherits(t,_wrapNativeSuper(HTMLElement)),_createClass(t,null,[{key:"observedAttributes",get:function(){return["url","save-button","editable"]}}]),_createClass(t,[{key:"init",value:function(){this.attr={};var e=!0,t=this.getAttribute("url"),n=this.getAttribute("editable"),r=this.getAttribute("save-button");if(this.resetDisplay(),this.setAttr("loadElement",createElement('<h1 class="text-info"><i class="fas fa-spinner fa-pulse"></i></h1>')),this.setAttr("errorElement",createElement('\n            <div class="alert alert-warning" role="alert">\n                <strong><span class="crudjs-error-t">ERROR</span>:</strong>\n                <span class="crudjs-error-m">Unknown</span>\n            </div>\n            ')),this.setAttr("messagesElement",createElement('<div style="position:fixed;right:10px;top:10px;z-index:100;"></div>')),null===t&&e?e=!1:this.setAttr("url",t),null!==n&&e)if(null!==r){var a=document.getElementById(r);null!==a?(this.setAttr("editable",!0),this.setAttr("saveButton",a)):e=!1}else e=!1;else this.setAttr("editable",!1);if(e){if(this.setAttr("data",null),this.setAttr("request",new CrudRequest(this.getUrl(),this.getAddMessageWrapper())),this.setAttr("table",new CrudTable(this)),document.body.appendChild(this.getAttr("messagesElement")),this.isEditable()){var i=this;this.getAttr("saveButton").onclick=function(){i.save()}}this.load()}else this.displayError("Error","Incorrect configuration. If you want to have an editable crud don't forget to give it a save-button.")}},{key:"load",value:function(){this.displayLoading(),this.getAttr("request").get(this.getDataLoadedWrapper(),this.getWrongUrlWrapper())}},{key:"wrongUrl",value:function(e){this.displayError("Error","An error occured while trying to fetch resource. See : "+e)}},{key:"dataLoaded",value:function(e){this.setAttr("data",e),this.displayTable()}},{key:"save",value:function(){this.getData()&&this.getAttr("request").send(this.getValues())}},{key:"addMessage",value:function(e,t,n,r){null==r&&(r=6e4);var a=createElement('\n            <div style="box-shadow:2px 2px 7px black;display:inline-block;float:right;clear:right;" class="alert alert-'+e+' alert-dismissible fade show" role="alert">\n              <strong>'+t+":</strong> "+n+'\n              <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n            </div>\n        ');this.getAttr("messagesElement").appendChild(a),setTimeout(function(){null!=a.parentNode&&a.getElementsByClassName("close")[0].click()},r)}},{key:"resetDisplay",value:function(){resetElementHTML(this)}},{key:"displayLoading",value:function(){this.setChild(this.getAttr("loadElement"))}},{key:"displayError",value:function(e,t){var n=this.getAttr("errorElement"),r=!0,a=!1,i=void 0;try{for(var l,s=n.getElementsByClassName("crudjs-error-t")[Symbol.iterator]();!(r=(l=s.next()).done);r=!0){l.value.textContent=e}}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}var o=!0,u=!1,d=void 0;try{for(var c,h=n.getElementsByClassName("crudjs-error-m")[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){c.value.textContent=t}}catch(e){u=!0,d=e}finally{try{o||null==h.return||h.return()}finally{if(u)throw d}}this.setChild(n)}},{key:"displayTable",value:function(){var e=this.getAttr("table");e.render(),this.setChild(e.getElement())}},{key:"connectedCallback",value:function(){}},{key:"disconnectedCallback",value:function(){}},{key:"adoptedCallback",value:function(){}},{key:"attributeChangedCallback",value:function(e,t,n){this.getData()&&n&&this.init()}},{key:"setAttr",value:function(e,t){this.attr[e]=t}},{key:"getAttr",value:function(e){return this.attr[e]}},{key:"getData",value:function(){return this.getAttr("data")}},{key:"getValues",value:function(){return this.getData().values}},{key:"getUrl",value:function(){return this.getAttr("url")}},{key:"isEditable",value:function(){return this.getAttr("editable")}},{key:"setChild",value:function(e){this.resetDisplay(),this.appendChild(e)}},{key:"getAddMessageWrapper",value:function(){var r=this;return function(e,t,n){r.addMessage(e,t,n)}}},{key:"getDataLoadedWrapper",value:function(){var t=this;return function(e){t.dataLoaded(e)}}},{key:"getWrongUrlWrapper",value:function(){var t=this;return function(e){t.wrongUrl(e)}}}]),t}();customElements.define("crud-js",CrudComponent);
>>>>>>> dev
